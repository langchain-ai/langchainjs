# Build System Plugins

The LangChain build system uses a plugin architecture to extend functionality. This document covers all available plugins and how to create custom ones.

## Available Plugins

### üîê lc-secrets Plugin

Scans TypeScript files for `lc_secrets` patterns and generates TypeScript interfaces for environment variables.

#### Purpose

The `lc_secrets` pattern is a LangChain convention where classes declare which environment variables they need for sensitive configuration (API keys, tokens, etc.). This plugin automatically:

1. Scans all TypeScript files for classes with `lc_secrets` getters
2. Validates environment variable naming conventions
3. Generates TypeScript interfaces for type safety
4. Reports validation errors

#### Usage

```typescript
import { lcSecretsPlugin } from "./plugins/lc-secrets.js";

await build({
  plugins: [
    lcSecretsPlugin({
      enabled: true,
      strict: true,
      packagePath: "/path/to/package",
      outputPath: "load/import_type.ts",
      excludePatterns: [".test.ts"],
    }),
  ],
});
```

#### What it detects

```typescript
class OpenAIProvider {
  get lc_secrets(): { [key: string]: string } {
    return {
      apiKey: "OPENAI_API_KEY", // ‚úÖ Valid - maps to process.env.OPENAI_API_KEY
      organization: "OPENAI_ORG_ID", // ‚úÖ Valid - maps to process.env.OPENAI_ORG_ID
      "api-key": "INVALID_KEY", // ‚ùå Must be uppercase
      "SPACED KEY": "ANOTHER_KEY", // ‚ùå No whitespace allowed
    };
  }
}
```

#### Generated Output

Creates `src/load/import_type.ts`:

```typescript
// Auto-generated by lc-secrets plugin. Do not edit manually.

export interface OptionalImportMap {}

export interface SecretMap {
  OPENAI_API_KEY?: string;
  OPENAI_ORG_ID?: string;
}
```

#### Configuration Options

| Option            | Type     | Default                                          | Description                         |
| ----------------- | -------- | ------------------------------------------------ | ----------------------------------- |
| `enabled`         | boolean  | `true`                                           | Enable/disable secret scanning      |
| `strict`          | boolean  | `true`                                           | Throw errors on validation failures |
| `packagePath`     | string   | `process.cwd()`                                  | Package root directory              |
| `outputPath`      | string   | `"load/import_type.ts"`                          | Output file path relative to src/   |
| `excludePatterns` | string[] | `[".test.ts", "test.ts", ".spec.ts", "spec.ts"]` | File patterns to exclude            |

---

### üìã import-constants Plugin

Generates arrays of entrypoint names that require optional dependencies for dynamic loading.

#### Purpose

LangChain packages often have entrypoints that depend on optional packages that users may not have installed. This plugin generates constants that help the runtime determine which modules can be safely imported.

#### Usage

```typescript
import { importConstantsPlugin } from "./plugins/import-constants.js";

await build({
  plugins: [
    importConstantsPlugin({
      enabled: true,
      packagePath: "/path/to/package",
      packageInfo: packageJson,
      optionalEntrypoints: ["anthropic", "openai"],
    }),
  ],
});
```

#### Generated Output

Creates `src/load/import_constants.ts`:

```typescript
// Auto-generated by import-constants plugin. Do not edit manually.

export const optionalImportEntrypoints: string[] = [
  "langchain_community/anthropic",
  "langchain_community/openai",
];
```

#### Configuration Options

| Option                | Type        | Description                                              |
| --------------------- | ----------- | -------------------------------------------------------- |
| `enabled`             | boolean     | Enable/disable import constants generation               |
| `packagePath`         | string      | Package root directory                                   |
| `packageInfo`         | PackageJson | Package.json content for reading entrypoints             |
| `outputPath`          | string      | Output file path (default: `"load/import_constants.ts"`) |
| `optionalEntrypoints` | string[]    | List of entrypoints requiring optional dependencies      |
| `deprecatedNodeOnly`  | string[]    | Entrypoints to exclude (deprecated)                      |

---

### üó∫Ô∏è import-map Plugin

Creates consolidated re-export files for all package entrypoints with namespace aliases.

#### Purpose

Import maps provide a single file that re-exports all entrypoints from a package, making it easy to access all functionality through one import. This is useful for:

- Bulk imports in testing
- Dynamic loading scenarios
- Package introspection
- Backward compatibility

#### Usage

```typescript
import { importMapPlugin } from "./plugins/import-map.js";

await build({
  plugins: [
    importMapPlugin({
      enabled: true,
      packagePath: "/path/to/package",
      packageInfo: packageJson,
      deprecatedNodeOnly: ["legacy-tool"],
      extraImportMapEntries: [
        {
          modules: ["CustomModule"],
          alias: ["custom"],
          path: "external-package",
        },
      ],
    }),
  ],
});
```

#### Generated Output

Creates `src/load/import_map.ts`:

```typescript
// Auto-generated by import-map plugin. Do not edit manually.

export * as index from "../index.js";
export * as tools__calculator from "../tools/calculator.js";
export * as providers__openai from "../providers/openai.js";

// Extra imports (if configured)
import { CustomModule } from "external-package";

const custom = {
  CustomModule,
};
export { custom };
```

#### How It Works

1. **Discovers** entrypoints from `package.json` exports field (using `input` property)
2. **Filters** based on configuration (deprecated, optional deps, etc.)
3. **Transforms** paths from `src/` to compiled output in `dist/`
4. **Namespaces** exports using double underscores: `tools/calculator` ‚Üí `tools__calculator`
5. **Handles** complex extra import scenarios with custom aliases

#### Configuration Options

| Option                        | Type                  | Description                                        |
| ----------------------------- | --------------------- | -------------------------------------------------- |
| `enabled`                     | boolean               | Enable/disable import map generation               |
| `packagePath`                 | string                | Package root directory                             |
| `packageInfo`                 | PackageJson           | Package.json content for reading entrypoints       |
| `outputPath`                  | string                | Output file path (default: `"load/import_map.ts"`) |
| `deprecatedNodeOnly`          | string[]              | Entrypoints to exclude (deprecated, Node.js only)  |
| `requiresOptionalDependency`  | string[]              | Entrypoints to exclude (requires optional deps)    |
| `deprecatedOmitFromImportMap` | string[]              | Entrypoints to exclude (deprecated from map)       |
| `extraImportMapEntries`       | ExtraImportMapEntry[] | Complex import/export patterns                     |

#### Extra Import Map Entries

For complex scenarios where you need to import from external packages and re-export with custom aliases:

```typescript
interface ExtraImportMapEntry {
  modules: Array<string>; // What to import: ['ModuleA', 'ModuleB']
  alias: Array<string>; // Alias parts: ['custom', 'tools']
  path: string; // Where to import from: 'external-package'
}

// Results in:
// import { ModuleA, ModuleB } from "external-package";
// const custom__tools = { ModuleA, ModuleB };
// export { custom__tools };
```
